<html>
	<body>
    <article role="main" class="page-content g-9">
        <h2 id="type-safe-builders">Type-Safe Builders<a class="anchor" href="#type-safe-builders"></a></h2>
        <p>The concept of <a href="http://www.groovy-lang.org/dsls.html#_nodebuilder">builders</a> is rather popular in the <em>Groovy</em> community.
            Builders allow for defining data in a semi-declarative way. Builders are good for <a href="http://www.groovy-lang.org/processing-xml.html#_creating_xml">generating XML</a>,
            <a href="http://www.groovy-lang.org/swing.html">laying out UI components</a>,
            <a href="http://www.artima.com/weblogs/viewpost.jsp?thread=296081">describing 3D scenes</a> and moreâ€¦</p>
        <p>For many use cases, Kotlin allows to <em>type-check</em> builders, which makes them even more attractive than the
            dynamically-typed implementation made in Groovy itself.</p>
        <p>For the rest of the cases, Kotlin supports Dynamic types builders.</p>
        <h2 id="a-type-safe-builder-example">A type-safe builder example<a class="anchor" href="#a-type-safe-builder-example"></a></h2>
        <p>Consider the following code:</p>
        <pre><code class="code _highlighted cm-s-default" data-lang="text/x-kotlin"><span class="cm-keyword">import</span> <span class="cm-variable">com</span>.<span class="cm-variable">example</span>.<span class="cm-variable">html</span>.<span class="cm-operator">*</span> <span class="cm-comment">// see declarations below</span>

<span class="cm-keyword">fun</span> <span class="cm-def">result</span>(<span class="cm-variable">args</span>: <span class="cm-variable">Array</span><span class="cm-operator">&lt;</span><span class="cm-variable-3">String</span><span class="cm-operator">&gt;</span>) <span class="cm-operator">=</span>
    <span class="cm-variable">html</span> {
        <span class="cm-variable">head</span> {
            <span class="cm-variable">title</span> {<span class="cm-operator">+</span><span class="cm-string">"XML encoding with Kotlin"</span>}
        }
        <span class="cm-variable">body</span> {
            <span class="cm-variable">h2</span> {<span class="cm-operator">+</span><span class="cm-string">"XML encoding with Kotlin"</span>}
            <span class="cm-variable">p</span>  {<span class="cm-operator">+</span><span class="cm-string">"this format can be used as an alternative markup to XML"</span>}

            <span class="cm-comment">// an element with attributes and text content</span>
            <span class="cm-variable">a</span>(<span class="cm-variable">href</span> <span class="cm-operator">=</span> <span class="cm-string">"http://kotlinlang.org"</span>) {<span class="cm-operator">+</span><span class="cm-string">"Kotlin"</span>}

            <span class="cm-comment">// mixed content</span>
            <span class="cm-variable">p</span> {
                <span class="cm-operator">+</span><span class="cm-string">"This is some"</span>
                <span class="cm-variable">b</span> {<span class="cm-operator">+</span><span class="cm-string">"mixed"</span>}
                <span class="cm-operator">+</span><span class="cm-string">"text. For more see the"</span>
                <span class="cm-variable">a</span>(<span class="cm-variable">href</span> <span class="cm-operator">=</span> <span class="cm-string">"http://kotlinlang.org"</span>) {<span class="cm-operator">+</span><span class="cm-string">"Kotlin"</span>}
                <span class="cm-operator">+</span><span class="cm-string">"project"</span>
            }
            <span class="cm-variable">p</span> {<span class="cm-operator">+</span><span class="cm-string">"some text"</span>}

            <span class="cm-comment">// content generated by</span>
            <span class="cm-variable">p</span> {
                <span class="cm-keyword">for</span> (<span class="cm-variable">arg</span> <span class="cm-keyword">in</span> <span class="cm-variable">args</span>)
                    <span class="cm-operator">+</span><span class="cm-variable">arg</span>
            }
        }
    }
</code></pre>
        <p>This is completely legitimate Kotlin code.
            You can play with this code online (modify it and run in the browser) <a href="http://try.kotlinlang.org/#/Examples/Longer examples/HTML Builder/HTML Builder.kt">here</a>.</p>
        <h2 id="how-it-works">How it works<a class="anchor" href="#how-it-works"></a></h2>
        <p>Let's walk through the mechanisms of implementing type-safe builders in Kotlin.
            First of all we need to define the model we want to build, in this case we need to model HTML tags.
            It is easily done with a bunch of classes.
            For example, <code>HTML</code> is a class that describes the <code>&lt;html&gt;</code> tag, i.e. it defines children like <code>&lt;head&gt;</code> and <code>&lt;body&gt;</code>.
            (See its declaration <a href="#full-definition-of-the-comexamplehtml-package">below</a>.)</p>
        <p>Now, let's recall why we can say something like this in the code:</p>
        <pre><code class="code _highlighted cm-s-default" data-lang="text/x-kotlin"><span class="cm-variable">html</span> {
 <span class="cm-comment">// ...</span>
}
</code></pre>
        <p><code>html</code> is actually a function call that takes a <a href="lambdas.html">lambda expression</a> as an argument.
            This function is defined as follows:</p>
        <pre><code class="code _highlighted cm-s-default" data-lang="text/x-kotlin"><span class="cm-keyword">fun</span> <span class="cm-def">html</span>(<span class="cm-keyword">init</span>: <span class="cm-variable">HTML</span>.() <span class="cm-operator">-&gt;</span> <span class="cm-variable">Unit</span>): <span class="cm-variable">HTML</span> {
    <span class="cm-keyword">val</span> <span class="cm-def">html</span> <span class="cm-operator">=</span> <span class="cm-variable">HTML</span>()
    <span class="cm-variable">html</span>.<span class="cm-keyword">init</span>()
    <span class="cm-keyword">return</span> <span class="cm-variable">html</span>
}
</code></pre>
        <p>This function takes one parameter named <code>init</code>, which is itself a function.
            The type of the function is <code>HTML.() -&gt; Unit</code>, which is a <em>function type with receiver</em>.
            This means that we need to pass an instance of type <code>HTML</code> (a <em>receiver</em>) to the function,
            and we can call members of that instance inside the function.
            The receiver can be accessed through the <em class="keyword">this</em> keyword:</p>
        <pre><code class="code _highlighted cm-s-default" data-lang="text/x-kotlin"><span class="cm-variable">html</span> {
    <span class="cm-keyword">this</span>.<span class="cm-variable">head</span> { <span class="cm-comment">/* ... */</span> }
    <span class="cm-keyword">this</span>.<span class="cm-variable">body</span> { <span class="cm-comment">/* ... */</span> }
}
</code></pre>
        <p>(<code>head</code> and <code>body</code> are member functions of <code>HTML</code>.)</p>
        <p>Now, <em class="keyword">this</em> can be omitted, as usual, and we get something that looks very much like a builder already:</p>
        <pre><code class="code _highlighted cm-s-default" data-lang="text/x-kotlin"><span class="cm-variable">html</span> {
    <span class="cm-variable">head</span> { <span class="cm-comment">/* ... */</span> }
    <span class="cm-variable">body</span> { <span class="cm-comment">/* ... */</span> }
}
</code></pre>
        <p>So, what does this call do? Let's look at the body of <code>html</code> function as defined above.
            It creates a new instance of <code>HTML</code>, then it initializes it by calling the function that is passed as an argument
            (in our example this boils down to calling <code>head</code> and <code>body</code> on the <code>HTML</code> instance), and then it returns this instance.
            This is exactly what a builder should do.</p>
        <p>The <code>head</code> and <code>body</code> functions in the <code>HTML</code> class are defined similarly to <code>html</code>.
            The only difference is that they add the built instances to the <code>children</code> collection of the enclosing <code>HTML</code> instance:</p>
        <pre><code class="code _highlighted cm-s-default" data-lang="text/x-kotlin"><span class="cm-keyword">fun</span> <span class="cm-def">head</span>(<span class="cm-keyword">init</span>: <span class="cm-variable">Head</span>.() <span class="cm-operator">-&gt;</span> <span class="cm-variable">Unit</span>) : <span class="cm-variable">Head</span> {
    <span class="cm-keyword">val</span> <span class="cm-def">head</span> <span class="cm-operator">=</span> <span class="cm-variable">Head</span>()
    <span class="cm-variable">head</span>.<span class="cm-keyword">init</span>()
    <span class="cm-variable">children</span>.<span class="cm-variable">add</span>(<span class="cm-variable">head</span>)
    <span class="cm-keyword">return</span> <span class="cm-variable">head</span>
}

<span class="cm-keyword">fun</span> <span class="cm-def">body</span>(<span class="cm-keyword">init</span>: <span class="cm-variable">Body</span>.() <span class="cm-operator">-&gt;</span> <span class="cm-variable">Unit</span>) : <span class="cm-variable">Body</span> {
    <span class="cm-keyword">val</span> <span class="cm-def">body</span> <span class="cm-operator">=</span> <span class="cm-variable">Body</span>()
    <span class="cm-variable">body</span>.<span class="cm-keyword">init</span>()
    <span class="cm-variable">children</span>.<span class="cm-variable">add</span>(<span class="cm-variable">body</span>)
    <span class="cm-keyword">return</span> <span class="cm-variable">body</span>
}
</code></pre>
        <p>Actually these two functions do just the same thing, so we can have a generic version, <code>initTag</code>:</p>
        <pre><code class="code _highlighted cm-s-default" data-lang="text/x-kotlin"><span class="cm-keyword">protected</span> <span class="cm-keyword">fun</span> <span class="cm-operator">&lt;</span><span class="cm-variable">T</span> : <span class="cm-variable">Element</span><span class="cm-operator">&gt;</span> <span class="cm-variable">initTag</span>(<span class="cm-variable">tag</span>: <span class="cm-variable">T</span>, <span class="cm-keyword">init</span>: <span class="cm-variable">T</span>.() <span class="cm-operator">-&gt;</span> <span class="cm-variable">Unit</span>): <span class="cm-variable">T</span> {
    <span class="cm-variable">tag</span>.<span class="cm-keyword">init</span>()
    <span class="cm-variable">children</span>.<span class="cm-variable">add</span>(<span class="cm-variable">tag</span>)
    <span class="cm-keyword">return</span> <span class="cm-variable">tag</span>
}
</code></pre>
        <p>So, now our functions are very simple:</p>
        <pre><code class="code _highlighted cm-s-default" data-lang="text/x-kotlin"><span class="cm-keyword">fun</span> <span class="cm-def">head</span>(<span class="cm-keyword">init</span>: <span class="cm-variable">Head</span>.() <span class="cm-operator">-&gt;</span> <span class="cm-variable">Unit</span>) <span class="cm-operator">=</span> <span class="cm-variable">initTag</span>(<span class="cm-variable">Head</span>(), <span class="cm-keyword">init</span>)

<span class="cm-keyword">fun</span> <span class="cm-def">body</span>(<span class="cm-keyword">init</span>: <span class="cm-variable">Body</span>.() <span class="cm-operator">-&gt;</span> <span class="cm-variable">Unit</span>) <span class="cm-operator">=</span> <span class="cm-variable">initTag</span>(<span class="cm-variable">Body</span>(), <span class="cm-keyword">init</span>)
</code></pre>
        <p>And we can use them to build <code>&lt;head&gt;</code> and <code>&lt;body&gt;</code> tags.</p>
        <p>One other thing to be discussed here is how we add text to tag bodies. In the example above we say something like:</p>
        <pre><code class="code _highlighted cm-s-default" data-lang="text/x-kotlin"><span class="cm-variable">html</span> {
    <span class="cm-variable">head</span> {
        <span class="cm-variable">title</span> {<span class="cm-operator">+</span><span class="cm-string">"XML encoding with Kotlin"</span>}
    }
    <span class="cm-comment">// ...</span>
}
</code></pre>
        <p>So basically, we just put a string inside a tag body, but there is this little <code>+</code> in front of it,
            so it is a function call that invokes a prefix <code>unaryPlus()</code> operation.
            That operation is actually defined by an extension function <code>unaryPlus()</code> that is a member of the <code>TagWithText</code> abstract class (a parent of <code>Title</code>):</p>
        <pre><code class="code _highlighted cm-s-default" data-lang="text/x-kotlin"><span class="cm-keyword">fun</span> <span class="cm-variable-3">String</span>.<span class="cm-variable">unaryPlus</span>() {
    <span class="cm-variable">children</span>.<span class="cm-variable">add</span>(<span class="cm-variable">TextElement</span>(<span class="cm-keyword">this</span>))
}
</code></pre>
        <p>So, what the prefix <code>+</code> does here is it wraps a string into an instance of <code>TextElement</code> and adds it to the <code>children</code> collection,
            so that it becomes a proper part of the tag tree.</p>
        <p>All this is defined in a package <code>com.example.html</code> that is imported at the top of the builder example above.
            In the last section you can read through the full definition of this package.</p>
        <h2 id="scope-control-dslmarker-since-11">Scope control: @DslMarker (since 1.1)<a class="anchor" href="#scope-control-dslmarker-since-11"></a></h2>
        <p>When using DSLs, one might have come across the problem that too many functions can be called in the context.
            We can call methods of every available implicit receiver inside a lambda and therefore get an inconsistent result, like the tag <code>head</code> inside another <code>head</code>:</p>
        <pre><code class="code _highlighted cm-s-default" data-lang="text/x-kotlin"><span class="cm-variable">html</span> {
    <span class="cm-variable">head</span> {
        <span class="cm-variable">head</span> {} <span class="cm-comment">// should be forbidden</span>
    }
    <span class="cm-comment">// ...</span>
}
</code></pre>
        <p>In this example only members of the nearest implicit receiver <code>this@head</code> must be available; <code>head()</code> is a member of the outer receiver <code>this@html</code>, so it must be illegal to call it.</p>
        <p>To address this problem, in Kotlin 1.1 a special mechanism to control receiver scope was introduced.</p>
        <p>To make the compiler start controlling scopes we only have to annotate the types of all receivers used in the DSL with the same marker annotation.
            For instance, for HTML Builders we declare an annotation <code>@HTMLTagMarker</code>:</p>
        <pre><code class="code _highlighted cm-s-default" data-lang="text/x-kotlin"><span class="cm-variable">@DslMarker</span>
<span class="cm-keyword">annotation</span> <span class="cm-keyword">class</span> <span class="cm-def">HtmlTagMarker</span>
</code></pre>
        <p>An annotation class is called a DSL marker if it is annotated with the <code>@DslMarker</code> annotation.</p>
        <p>In our DSL all the tag classes extend the same superclass <code>Tag</code>.
            It's enough to annotate only the superclass with <code>@HtmlTagMarker</code> and after that the Kotlin compiler will treat all the inherited classes as annotated:</p>
        <pre><code class="code _highlighted cm-s-default" data-lang="text/x-kotlin"><span class="cm-variable">@HtmlTagMarker</span>
<span class="cm-keyword">abstract</span> <span class="cm-keyword">class</span> <span class="cm-def">Tag</span>(<span class="cm-keyword">val</span> <span class="cm-def">name</span>: <span class="cm-variable-3">String</span>) { ... }
</code></pre>
        <p>We don't have to annotate the <code>HTML</code> or <code>Head</code> classes with <code>@HtmlTagMarker</code> because their superclass is already annotated:</p>
        <pre><code>class HTML() : Tag("html") { ... }
class Head() : Tag("head") { ... }
</code></pre>
        <p>After we've added this annotation, the Kotlin compiler knows which implicit receivers are part of the same DSL and allows to call members of the nearest receivers only:</p>
        <pre><code class="code _highlighted cm-s-default" data-lang="text/x-kotlin"><span class="cm-variable">html</span> {
    <span class="cm-variable">head</span> {
        <span class="cm-variable">head</span> { } <span class="cm-comment">// error: a member of outer receiver</span>
    }
    <span class="cm-comment">// ...</span>
}
</code></pre>
        <p>Note that it's still possible to call the members of the outer receiver, but to do that you have to specify this receiver explicitly:</p>
        <pre><code class="code _highlighted cm-s-default" data-lang="text/x-kotlin"><span class="cm-variable">html</span> {
    <span class="cm-variable">head</span> {
        <span class="cm-keyword">this</span><span class="cm-variable">@html</span>.<span class="cm-variable">head</span> { } <span class="cm-comment">// possible</span>
    }
    <span class="cm-comment">// ...</span>
}
</code></pre>
        <h2 id="full-definition-of-the-comexamplehtml-package">Full definition of the <code>com.example.html</code> package<a class="anchor" href="#full-definition-of-the-comexamplehtml-package"></a></h2>
        <p>This is how the package <code>com.example.html</code> is defined (only the elements used in the example above).
            It builds an HTML tree. It makes heavy use of <a href="extensions.html">extension functions</a> and
            <a href="lambdas.html#function-literals-with-receiver">lambdas with receiver</a>.</p>
        <p>Note that the <code>@DslMarker</code> annotation is available only since Kotlin 1.1.</p>
        <p><a name="declarations"></a></p>
        <pre><code class="code _highlighted cm-s-default" data-lang="text/x-kotlin"><span class="cm-keyword">package</span> <span class="cm-def">com</span>.<span class="cm-variable">example</span>.<span class="cm-variable">html</span>

<span class="cm-keyword">interface</span> <span class="cm-def">Element</span> {
    <span class="cm-keyword">fun</span> <span class="cm-def">render</span>(<span class="cm-variable">builder</span>: <span class="cm-variable">StringBuilder</span>, <span class="cm-variable">indent</span>: <span class="cm-variable-3">String</span>)
}

<span class="cm-keyword">class</span> <span class="cm-def">TextElement</span>(<span class="cm-keyword">val</span> <span class="cm-def">text</span>: <span class="cm-variable-3">String</span>) : <span class="cm-variable">Element</span> {
    <span class="cm-keyword">override</span> <span class="cm-keyword">fun</span> <span class="cm-def">render</span>(<span class="cm-variable">builder</span>: <span class="cm-variable">StringBuilder</span>, <span class="cm-variable">indent</span>: <span class="cm-variable-3">String</span>) {
        <span class="cm-variable">builder</span>.<span class="cm-variable">append</span>(<span class="cm-string">"$indent$text\n"</span>)
    }
}

<span class="cm-variable">@DslMarker</span>
<span class="cm-keyword">annotation</span> <span class="cm-keyword">class</span> <span class="cm-def">HtmlTagMarker</span>

<span class="cm-def">@HtmlTagMarker</span>
<span class="cm-keyword">abstract</span> <span class="cm-keyword">class</span> <span class="cm-def">Tag</span>(<span class="cm-keyword">val</span> <span class="cm-def">name</span>: <span class="cm-variable-3">String</span>) : <span class="cm-variable">Element</span> {
    <span class="cm-keyword">val</span> <span class="cm-def">children</span> <span class="cm-operator">=</span> <span class="cm-variable">arrayListOf</span><span class="cm-operator">&lt;</span><span class="cm-variable">Element</span><span class="cm-operator">&gt;</span>()
    <span class="cm-keyword">val</span> <span class="cm-def">attributes</span> <span class="cm-operator">=</span> <span class="cm-variable">hashMapOf</span><span class="cm-operator">&lt;</span><span class="cm-variable-3">String</span>, <span class="cm-variable-3">String</span><span class="cm-operator">&gt;</span>()

    <span class="cm-keyword">protected</span> <span class="cm-keyword">fun</span> <span class="cm-operator">&lt;</span><span class="cm-variable">T</span> : <span class="cm-variable">Element</span><span class="cm-operator">&gt;</span> <span class="cm-variable">initTag</span>(<span class="cm-variable">tag</span>: <span class="cm-variable">T</span>, <span class="cm-keyword">init</span>: <span class="cm-variable">T</span>.() <span class="cm-operator">-&gt;</span> <span class="cm-variable">Unit</span>): <span class="cm-variable">T</span> {
        <span class="cm-variable">tag</span>.<span class="cm-keyword">init</span>()
        <span class="cm-variable">children</span>.<span class="cm-variable">add</span>(<span class="cm-variable">tag</span>)
        <span class="cm-keyword">return</span> <span class="cm-variable">tag</span>
    }

    <span class="cm-keyword">override</span> <span class="cm-keyword">fun</span> <span class="cm-def">render</span>(<span class="cm-variable">builder</span>: <span class="cm-variable">StringBuilder</span>, <span class="cm-variable">indent</span>: <span class="cm-variable-3">String</span>) {
        <span class="cm-variable">builder</span>.<span class="cm-variable">append</span>(<span class="cm-string">"$indent&lt;$name${renderAttributes()}&gt;\n"</span>)
        <span class="cm-keyword">for</span> (<span class="cm-variable">c</span> <span class="cm-keyword">in</span> <span class="cm-variable">children</span>) {
            <span class="cm-variable">c</span>.<span class="cm-variable">render</span>(<span class="cm-variable">builder</span>, <span class="cm-variable">indent</span> <span class="cm-operator">+</span> <span class="cm-string">"  "</span>)
        }
        <span class="cm-variable">builder</span>.<span class="cm-variable">append</span>(<span class="cm-string">"$indent&lt;/$name&gt;\n"</span>)
    }

    <span class="cm-keyword">private</span> <span class="cm-keyword">fun</span> <span class="cm-def">renderAttributes</span>(): <span class="cm-variable-3">String</span> {
        <span class="cm-keyword">val</span> <span class="cm-def">builder</span> <span class="cm-operator">=</span> <span class="cm-variable">StringBuilder</span>()
        <span class="cm-keyword">for</span> ((<span class="cm-variable">attr</span>, <span class="cm-variable">value</span>) <span class="cm-keyword">in</span> <span class="cm-variable">attributes</span>) {
            <span class="cm-variable">builder</span>.<span class="cm-variable">append</span>(<span class="cm-string">" $attr=\"$value\""</span>)
        }
        <span class="cm-keyword">return</span> <span class="cm-variable">builder</span>.<span class="cm-variable">toString</span>()
    }

    <span class="cm-keyword">override</span> <span class="cm-keyword">fun</span> <span class="cm-def">toString</span>(): <span class="cm-variable-3">String</span> {
        <span class="cm-keyword">val</span> <span class="cm-def">builder</span> <span class="cm-operator">=</span> <span class="cm-variable">StringBuilder</span>()
        <span class="cm-variable">render</span>(<span class="cm-variable">builder</span>, <span class="cm-string">""</span>)
        <span class="cm-keyword">return</span> <span class="cm-variable">builder</span>.<span class="cm-variable">toString</span>()
    }
}

<span class="cm-keyword">abstract</span> <span class="cm-keyword">class</span> <span class="cm-def">TagWithText</span>(<span class="cm-variable">name</span>: <span class="cm-variable-3">String</span>) : <span class="cm-variable">Tag</span>(<span class="cm-variable">name</span>) {
    <span class="cm-keyword">operator</span> <span class="cm-keyword">fun</span> <span class="cm-variable-3">String</span>.<span class="cm-variable">unaryPlus</span>() {
        <span class="cm-variable">children</span>.<span class="cm-variable">add</span>(<span class="cm-variable">TextElement</span>(<span class="cm-keyword">this</span>))
    }
}

<span class="cm-keyword">class</span> <span class="cm-def">HTML</span> : <span class="cm-variable">TagWithText</span>(<span class="cm-string">"html"</span>) {
    <span class="cm-keyword">fun</span> <span class="cm-def">head</span>(<span class="cm-keyword">init</span>: <span class="cm-variable">Head</span>.() <span class="cm-operator">-&gt;</span> <span class="cm-variable">Unit</span>) <span class="cm-operator">=</span> <span class="cm-variable">initTag</span>(<span class="cm-variable">Head</span>(), <span class="cm-keyword">init</span>)

    <span class="cm-keyword">fun</span> <span class="cm-def">body</span>(<span class="cm-keyword">init</span>: <span class="cm-variable">Body</span>.() <span class="cm-operator">-&gt;</span> <span class="cm-variable">Unit</span>) <span class="cm-operator">=</span> <span class="cm-variable">initTag</span>(<span class="cm-variable">Body</span>(), <span class="cm-keyword">init</span>)
}

<span class="cm-keyword">class</span> <span class="cm-def">Head</span> : <span class="cm-variable">TagWithText</span>(<span class="cm-string">"head"</span>) {
    <span class="cm-keyword">fun</span> <span class="cm-def">title</span>(<span class="cm-keyword">init</span>: <span class="cm-variable">Title</span>.() <span class="cm-operator">-&gt;</span> <span class="cm-variable">Unit</span>) <span class="cm-operator">=</span> <span class="cm-variable">initTag</span>(<span class="cm-variable">Title</span>(), <span class="cm-keyword">init</span>)
}

<span class="cm-keyword">class</span> <span class="cm-def">Title</span> : <span class="cm-variable">TagWithText</span>(<span class="cm-string">"title"</span>)

<span class="cm-keyword">abstract</span> <span class="cm-keyword">class</span> <span class="cm-def">BodyTag</span>(<span class="cm-variable">name</span>: <span class="cm-variable-3">String</span>) : <span class="cm-variable">TagWithText</span>(<span class="cm-variable">name</span>) {
    <span class="cm-keyword">fun</span> <span class="cm-def">b</span>(<span class="cm-keyword">init</span>: <span class="cm-variable">B</span>.() <span class="cm-operator">-&gt;</span> <span class="cm-variable">Unit</span>) <span class="cm-operator">=</span> <span class="cm-variable">initTag</span>(<span class="cm-variable">B</span>(), <span class="cm-keyword">init</span>)
    <span class="cm-keyword">fun</span> <span class="cm-def">p</span>(<span class="cm-keyword">init</span>: <span class="cm-variable">P</span>.() <span class="cm-operator">-&gt;</span> <span class="cm-variable">Unit</span>) <span class="cm-operator">=</span> <span class="cm-variable">initTag</span>(<span class="cm-variable">P</span>(), <span class="cm-keyword">init</span>)
    <span class="cm-keyword">fun</span> <span class="cm-def">h2</span>(<span class="cm-keyword">init</span>: <span class="cm-variable">h2</span>.() <span class="cm-operator">-&gt;</span> <span class="cm-variable">Unit</span>) <span class="cm-operator">=</span> <span class="cm-variable">initTag</span>(<span class="cm-variable">h2</span>(), <span class="cm-keyword">init</span>)
    <span class="cm-keyword">fun</span> <span class="cm-def">a</span>(<span class="cm-variable">href</span>: <span class="cm-variable-3">String</span>, <span class="cm-keyword">init</span>: <span class="cm-variable">A</span>.() <span class="cm-operator">-&gt;</span> <span class="cm-variable">Unit</span>) {
        <span class="cm-keyword">val</span> <span class="cm-def">a</span> <span class="cm-operator">=</span> <span class="cm-variable">initTag</span>(<span class="cm-variable">A</span>(), <span class="cm-keyword">init</span>)
        <span class="cm-variable">a</span>.<span class="cm-variable">href</span> <span class="cm-operator">=</span> <span class="cm-variable">href</span>
    }
}

<span class="cm-keyword">class</span> <span class="cm-def">Body</span> : <span class="cm-variable">BodyTag</span>(<span class="cm-string">"body"</span>)
<span class="cm-keyword">class</span> <span class="cm-def">B</span> : <span class="cm-variable">BodyTag</span>(<span class="cm-string">"b"</span>)
<span class="cm-keyword">class</span> <span class="cm-def">P</span> : <span class="cm-variable">BodyTag</span>(<span class="cm-string">"p"</span>)
<span class="cm-keyword">class</span> <span class="cm-def">h2</span> : <span class="cm-variable">BodyTag</span>(<span class="cm-string">"h2"</span>)

<span class="cm-keyword">class</span> <span class="cm-def">A</span> : <span class="cm-variable">BodyTag</span>(<span class="cm-string">"a"</span>) {
    <span class="cm-keyword">var</span> <span class="cm-def">href</span>: <span class="cm-variable-3">String</span>
        <span class="cm-keyword">get</span>() <span class="cm-operator">=</span> <span class="cm-variable">attributes</span>[<span class="cm-string">"href"</span>]<span class="cm-operator">!!</span>
        <span class="cm-keyword">set</span>(<span class="cm-variable">value</span>) {
            <span class="cm-variable">attributes</span>[<span class="cm-string">"href"</span>] <span class="cm-operator">=</span> <span class="cm-variable">value</span>
        }
}

<span class="cm-keyword">fun</span> <span class="cm-def">html</span>(<span class="cm-keyword">init</span>: <span class="cm-variable">HTML</span>.() <span class="cm-operator">-&gt;</span> <span class="cm-variable">Unit</span>): <span class="cm-variable">HTML</span> {
    <span class="cm-keyword">val</span> <span class="cm-def">html</span> <span class="cm-operator">=</span> <span class="cm-variable">HTML</span>()
    <span class="cm-variable">html</span>.<span class="cm-keyword">init</span>()
    <span class="cm-keyword">return</span> <span class="cm-variable">html</span>
}
</code></pre>

    </article>
    </body>
    <link href="file:///android_asset/css/general.css" type="text/css" rel="stylesheet" />
</html>